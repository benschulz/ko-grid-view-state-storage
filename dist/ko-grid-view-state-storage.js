/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
function p(q){return function(n){return n}(function(n,c,a){function m(a,b,l){function d(e){return b()+"."+e}var f={};this.read=function(b){return a.read(d(b))};this.f=function(b,l){return a.f(d(b),l)};this.bind=function(b,d){if(c.b.k(f,b))throw Error("The key `"+b+"` is already bound.");var a=d.subscribe(function(d){l()||this.f(b,d)}.bind(this)),h=f[b]={p:function(){var a=this.read(b);void 0===a?this.f(b,d()):d(a)}.bind(this),key:b,observable:d,dispose:function(){a.dispose();delete f[b]}};h.p();return h}.bind(this);
this.q=function(){c.b.m(f,function(b,d){d.p()})};this.w=function(){c.b.m(f,function(b,d){d.dispose();delete f[b]})}}function k(){this.read=function(a){a=window.localStorage.getItem(a);return null===a?void 0:JSON.parse(a)};this.f=function(a,b){void 0!==b&&window.localStorage.setItem(a,JSON.stringify(b))}}a.defineExtension("ko-grid-view-state-storage",{R:["ko-grid-view-modes"],f:function(a,b,l){var d=this,f="koGrid."+c.i.s(l.rootElement.id);a=b.keyValueStore||new k;var e=!1;d.t=new m(a,function(){return f},
function(){return!1});d.n=new m(a,function(){return f+"["+l.extensions["ko-grid-view-modes"].activeModes().join(";")+"]"},function(){return e});var g=l.extensions["ko-grid-view-modes"].activeModes.subscribe(function(){e=!0},null,"beforeChange"),n=l.extensions["ko-grid-view-modes"].activeModes.subscribe(function(){e=!1;d.n.q()});l.postApplyBindings(function(){return[d.t,d.n].forEach(function(b){return b.q()})});d.dispose=function(){g.dispose();n.dispose();[d.t,d.n].forEach(function(b){return b.w()})}}});
return a.declareExtensionAlias("viewStateStorage","ko-grid-view-state-storage")}({},function(){var n;n=function(){function c(a,c){return Object.prototype.hasOwnProperty.call(a,c)}return{B:function(a,c){if(a===c)return!0;var k=!!c&&"function"===typeof c.valueOf;return!!a&&"function"===typeof a.valueOf&&k&&a.valueOf()===c.valueOf()},extend:function(a,c){Array.prototype.slice.call(arguments,1).forEach(function(c){for(var h=Object.keys(c),b=0,l=h.length;b<l;b++){var d=h[b],f=Object.getOwnPropertyDescriptor(c,
d);void 0!==f&&f.enumerable&&Object.defineProperty(a,d,f)}});return a},m:function(a,m){for(var k in a)c(a,k)&&m(k,a[k])},k:c,J:function(a,m){var k={},h;for(h in a)c(a,h)&&(k[h]=m(a[h],h,a));return k}}}();return function(c){return c}(function(c,a,m,k){return{c:c,d:a,b:m,i:k}}(function(c){function a(b){return b.filter(function(b,a,c){return c.lastIndexOf(b)===a})}function m(b,a){for(var d=b.length,c=-1,e=0;e<d;++e)if(a(b[e])){if(0<=c)throw Error("Multiple elements match the predicate.");c=e}return c}
function k(b,a){return b&&"function"===typeof b.valueOf&&a&&"function"===typeof a.valueOf?b.valueOf()<=a.valueOf()?b.valueOf()<a.valueOf()?-1:0:1:b<=a?b<a?-1:0:1}function h(b,a){var d=b.length,c=Array(d),e=Array(d),g;for(g=0;g<d;++g)c[g]=g,e[g]=b[g];g=b;b=e;e=g;c.sort(function(c,d){return a(b[c],b[d])||c-d});for(g=0;g<d;++g)e[g]=b[c[g]];return e}return{contains:function(b,a){return 0<=b.indexOf(a)},F:function(b){if(50<b.length){for(var l=b.length,d={},f,e=0;e<l;++e)if(f=b[e],"string"===typeof f)if(c.k(d,
f))break;else d[f]=!0;else if(b.lastIndexOf(f)!==e)break;if(!(e>=l)){for(var g=b.slice(0,e);e<l;++e)f=b[e],"string"===typeof f?c.k(d,f)||(d[f]=!0,g.push(f)):b.lastIndexOf(f)===e&&g.push(f);b=g}}else b=a(b);return b},G:function(b,a){return Array.prototype.concat.apply([],b.map(a))},L:function(b,a){var c=m(b,a);if(0>c)throw Error("None of the elements matches the predicate.");return b[c]},M:function(b,a){var c=m(b,a);return 0<=c?b[c]:null},N:function(b,a){var c=a||k;window.chrome?c=h(b,c):(b.sort(c),
c=b);return c}}}(n),function(){function c(a){return function(){return a}}return{ea:c(!0),U:c(!1),Z:c(void 0),$:c(null),fa:c(0),C:c,H:function(a){return a}}}(),n,{D:function(c){return c.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})},s:function(c){return c.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()})},format:function(c){var a=arguments;return c.replace(/{(\d+)}/g,function(c,k){var h=parseInt(k,10)+1;return typeof a.length<=h?c:a[h]})}}))}(),q))}
"function"===typeof define&&define.amd?define(["ko-grid","ko-grid-view-modes","ko-data-source","ko-indexed-repeat","knockout"],p):window["ko-grid-view-state-storage"]=p(window.ko.bindingHandlers.grid);